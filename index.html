<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MZ Music - Login</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding: 50px; background: #121212; color: white; }
        .login-card { background: #1db954; padding: 20px; border-radius: 8px; width: 300px; }
        input { width: 90%; margin: 10px 0; padding: 10px; border-radius: 5px; border: none; }
        button { width: 100%; padding: 10px; background: black; color: white; border: none; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="login-card" id="loginArea">
        <h2>Acesso Administrativo</h2>
        <input type="text" id="usuario" placeholder="Usuário">
        <input type="password" id="senha" placeholder="Senha">
        <button onclick="fazerLogin()">Entrar</button>
    </div>

    <hr>

    <div class="login-card" id="uploadArea" style="margin-top: 20px;">
        <h2>Cadastrar Música</h2>
        <input type="text" id="nomeMusica" placeholder="Nome da Música">
        <input type="text" id="artistaMusica" placeholder="Nome do Artista">
        
        <label>Arquivo de Áudio (MP3):</label>
        <input type="file" id="arquivoAudio" accept="audio/*">
        
        <label>Capa da Música (Imagem):</label>
        <input type="file" id="arquivoCapa" accept="image/*">
        
        <button onclick="enviarMusica()">Enviar Música</button>
    </div>

    <hr>
      <h2>Minha Biblioteca Musical</h2>
      <div id="listaMusicas" style="display: flex; flex-wrap: wrap; gap: 20px;">
    </div>

    <script>
        async function fazerLogin() {
            const usuario = document.getElementById('usuario').value;
            const senha = document.getElementById('senha').value;

            const response = await fetch('https://mz-music-backend.onrender.com/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ usuario, senha })
            });

            const data = await response.json();

            if (response.ok) {
                // Aqui o site guarda o Token sozinho para você!
                localStorage.setItem('token', data.token);
                alert('Login realizado com sucesso!');
                // Aqui vamos redirecionar para a página de cadastro depois
            } else {
                alert('Erro: ' + data.error);
            }
        }

        async function enviarMusica() {
        const token = localStorage.getItem('token'); // Pega a chave que guardamos no login
        if (!token) return alert("Faça login primeiro!");

        const formData = new FormData();
        formData.append('nome', document.getElementById('nomeMusica').value);
        formData.append('artista', document.getElementById('artistaMusica').value);
        formData.append('audio', document.getElementById('arquivoAudio').files[0]);
        formData.append('capa', document.getElementById('arquivoCapa').files[0]);

        const response = await fetch('https://mz-music-backend.onrender.com/musicas', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }, // Envia o token automaticamente
            body: formData
        });

        const data = await response.json();
        if (data.isOk) {
            alert("✅ Música cadastrada com sucesso!");
        } else {
            alert("❌ Erro: " + data.error);
        }
    }

        async function carregarMusicas() {
        const response = await fetch('https://mz-music-backend.onrender.com/musicas');
        const musicas = await response.json();

        const lista = document.getElementById('listaMusicas');
        lista.innerHTML = ''; // Limpa a lista antes de carregar

        musicas.forEach(m => {
            lista.innerHTML += `
                <div style="background: #282828; padding: 15px; border-radius: 10px; width: 200px; text-align: center;">
                    <img src="${m.url_capa}" style="width: 100%; border-radius: 5px;">
                    <h3 style="margin: 10px 0 5px 0;">${m.nome}</h3>
                    <p style="color: #b3b3b3; font-size: 14px;">${m.artista}</p>
                    <audio controls style="width: 100%; margin-top: 10px;">
                        <source src="${m.url_audio}" type="audio/mpeg">
                    </audio>
                </div>
            `;
        });
    }

    // Chama a função automaticamente quando abrir a página
    carregarMusicas();

    // Dentro do seu musicas.forEach
    lista.innerHTML += `
        <div style="background: #282828; padding: 15px; border-radius: 10px; width: 200px; text-align: center;">
            <img src="${m.url_capa}" style="width: 100%; border-radius: 5px;">
            <h3 style="margin: 10px 0 5px 0;">${m.nome}</h3>
            <p style="color: #b3b3b3; font-size: 14px;">${m.artista}</p>
            
            <audio controls src="${m.url_audio}" style="width: 100%; margin-top: 10px;">
                Seu navegador não suporta áudio.
            </audio>
        </div>
    `;
    
    </script>
</body>
</html>